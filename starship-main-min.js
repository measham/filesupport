gsap.registerPlugin(SplitText,ScrollTrigger,ScrambleTextPlugin,MotionPathPlugin);let modalAnimationInitialized=!1;const modalTimelines=new WeakMap();let idleEasterEggInitialized=!1;let idleEasterEggTimer=null;let homeDefineScrubActive=!1;let defineBlocksMap=null;let defineDefaultKey="intro";let defineCurrentKey=null;let defineHoverActive=!1;let defineScrubKey=null;let menuAnimationInitialized=!1;function initDefineState(scope){if(defineBlocksMap)return;const container=scope||document;const defineEls=Array.from(container.querySelectorAll("[data-define]"));if(!defineEls.length)return;defineBlocksMap={};defineEls.forEach((el)=>{const key=el.getAttribute("data-define");if(!key)return;defineBlocksMap[key]=el});if(!defineBlocksMap[defineDefaultKey]){defineDefaultKey=defineEls[0].getAttribute("data-define")||"intro"}
defineCurrentKey=defineDefaultKey;defineScrubKey=defineDefaultKey;Object.entries(defineBlocksMap).forEach(([key,el])=>{gsap.set(el,{autoAlpha:key===defineDefaultKey?1:0})})}
function showDefine(key){if(!defineBlocksMap||!defineBlocksMap[key])return;if(key===defineCurrentKey)return;const allDefines=Object.values(defineBlocksMap);const nextEl=defineBlocksMap[key];defineCurrentKey=key;gsap.killTweensOf(allDefines);gsap.set(allDefines,{autoAlpha:0});gsap.fromTo(nextEl,{autoAlpha:0},{autoAlpha:1,duration:0.2,ease:"power2.out",overwrite:"auto"})}
function setDefineFromScrub(key){defineScrubKey=key;if(!defineHoverActive){showDefine(key)}}
function setDefineFromHover(key){return}
function clearDefineHoverOverride(){defineHoverActive=!1}
function getElements(animationType,trigger){const selector=trigger?`[data-text-animation="${animationType}"][data-text-trigger="${trigger}"]`:`[data-text-animation="${animationType}"]`;return document.querySelectorAll(selector)}
function animateHeading(trigger){if(trigger==="scroll")return;const elements=getElements("heading",trigger);if(!elements.length)return;elements.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"lines, words, chars",linesClass:"line",charsClass:"char",wordsClass:"word",autoSplit:!0});const duration=parseFloat(el.getAttribute("data-text-duration"))||0.9;const delay=parseFloat(el.getAttribute("data-text-delay"))||0;const hasGradient=el.dataset.textGradient==="true";const gradientFrom=el.dataset.textGradientFrom||"#FEFEFE";const gradientTo=el.dataset.textGradientTo||"#635345";const colorInterpolator=hasGradient?gsap.utils.interpolate(gradientFrom,gradientTo):null;const headingTl=gsap.timeline({delay,onComplete:()=>{if(!hasGradient){split.revert()}}});split.lines.forEach((line)=>{const lineChars=split.chars.filter((char)=>line.contains(char));if(!lineChars.length)return;if(hasGradient&&colorInterpolator){const total=Math.max(lineChars.length-1,1);lineChars.forEach((char,index)=>{const ratio=index/total;const targetColor=colorInterpolator(ratio);gsap.set(char,{color:targetColor})})}
headingTl.from(lineChars,{duration,opacity:0,filter:"blur(10px)",ease:"power2.out",stagger:0.05},0)})})}
function animateTerminal(trigger){if(trigger==="scroll")return;const elements=getElements("terminal",trigger);if(!elements.length)return;elements.forEach((el)=>{if(trigger==="preloader"){const calibratingWrapper=el.closest(".preloader__calibrating");if(calibratingWrapper){gsap.set(calibratingWrapper,{visibility:"visible"})}}
gsap.set(el,{autoAlpha:1,visibility:"visible"});const split=new SplitText(el,{type:"words,chars",charsClass:"char",wordsClass:"word",autoSplit:!0});const chars=split.chars;if(!chars.length)return;const delayAttr=el.getAttribute("data-text-delay")||"0";const durationAttr=el.getAttribute("data-text-duration")||el.getAttribute("data-text-duration-seconds")||"1.8";const delay=parseFloat(delayAttr)||0;const charDuration=parseFloat(durationAttr)||1.8;const charStagger=0.035;const cursorBlinkDuration=0.15;const cursorBlinkRepeats=4;const cursorFadeDuration=charDuration*0.7;const scrambleChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.";const lastIndex=chars.length-1;const textNodes=chars.map((char)=>{if(char.__terminalTextNode&&char.contains(char.__terminalTextNode)){return char.__terminalTextNode}
const textSpan=document.createElement("span");textSpan.className="terminal-char__text";textSpan.textContent=char.textContent||"";char.textContent="";char.appendChild(textSpan);char.__terminalTextNode=textSpan;return textSpan});gsap.set(textNodes,{autoAlpha:0});chars.forEach((char)=>{char.style.setProperty("--terminal-cursor-opacity","0")});let currentCursorIndex=null;let hasReverted=!1;const setCursor=(targetIndex)=>{if(typeof currentCursorIndex==="number"&&chars[currentCursorIndex]){chars[currentCursorIndex].style.setProperty("--terminal-cursor-opacity","0");const previousTextNode=textNodes[currentCursorIndex];if(previousTextNode){gsap.to(previousTextNode,{autoAlpha:0.4,duration:0.2,ease:"power2.out",onComplete:()=>{gsap.to(previousTextNode,{autoAlpha:1,duration:0.2,ease:"power2.out"})}})}}
if(typeof targetIndex==="number"&&chars[targetIndex]){chars[targetIndex].style.setProperty("--terminal-cursor-opacity","1");currentCursorIndex=targetIndex}else{currentCursorIndex=null}};const cleanup=()=>{if(hasReverted)return;hasReverted=!0;setCursor(null);split.revert()};const tl=gsap.timeline({delay,defaults:{duration:charDuration,ease:"power2.out"}});textNodes.forEach((textNode,index)=>{tl.to(textNode,{scrambleText:{text:"{original}",chars:scrambleChars,speed:0.55},onStart:()=>{setCursor(index);gsap.set(textNode,{autoAlpha:1})}},index*charStagger)});const lastCharStart=lastIndex*charStagger;const cursorBlinkTl=gsap.timeline();cursorBlinkTl.to(chars[lastIndex],{duration:cursorBlinkDuration,"--terminal-cursor-opacity":0,repeat:cursorBlinkRepeats,yoyo:!0,ease:"none"}).to(chars[lastIndex],{duration:cursorFadeDuration,"--terminal-cursor-opacity":0,ease:"power1.inOut",onComplete:cleanup});tl.add(()=>setCursor(lastIndex),lastCharStart);tl.add(cursorBlinkTl,lastCharStart);tl.play()})}
function animateRandom(trigger){if(trigger==="scroll")return;const elements=getElements("random",trigger);if(!elements.length)return;elements.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"words, chars",charsClass:"char",wordsClass:"word",autoSplit:!0});const duration=parseFloat(el.getAttribute("data-text-duration"))||0.6;const delay=parseFloat(el.getAttribute("data-text-delay"))||0;gsap.from(split.chars,{opacity:0,duration,delay,ease:"power2.out",stagger:{each:0.004,from:"random"},onComplete:()=>split.revert()})})}
function initPreloaderAnimation(){const preloader=document.querySelector(".preloader");if(!preloader){return null}
const isPlanets=preloader.getAttribute("data-preloader")==="planets";const speedFactor=isPlanets?0.9:1;const fast=(value)=>value*speedFactor;const bg=preloader.querySelector(".preloader__bg");const container=preloader.querySelector(".container.cc-preloader");const bgLines=preloader.querySelectorAll(".preloader__bg-line");const preloaderTitles=preloader.querySelectorAll('[data-text-animation="preloader-title"]');const bgTerminalTexts=preloader.querySelectorAll('[data-text-animation="bg-terminal"]');const icon=preloader.querySelector(".preloader__icon-svg");const tl=gsap.timeline({defaults:{ease:"power2.out"}});const splitsToRevert=[];if(container){tl.fromTo(container,{opacity:0},{opacity:1,duration:fast(0.6)},0)}
if(bg){gsap.set(bg,{opacity:0});tl.to(bg,{opacity:1,duration:fast(1)},0)}
tl.addLabel("introDone");if(bgLines.length){tl.fromTo(bgLines,{clipPath:"inset(0 0% 0 100%)"},{clipPath:"inset(0 0% 0 0%)",duration:fast(2.8),stagger:0.5,ease:"linear"},"introDone")}
if(preloaderTitles.length){const allTitleChars=[];preloaderTitles.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"words, chars",charsClass:"char",wordsClass:"word",autoSplit:!0});splitsToRevert.push(split);allTitleChars.push(...split.chars)});if(allTitleChars.length){tl.fromTo(allTitleChars,{opacity:0,filter:"blur(10px)"},{opacity:1,filter:"blur(0px)",duration:fast(0.8),stagger:0.03},"introDone+=0.2")}}
if(bgTerminalTexts.length){bgTerminalTexts.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"words, chars",charsClass:"char",wordsClass:"word",autoSplit:!0});splitsToRevert.push(split);const chars=split.chars.filter((c)=>c.textContent.trim());if(!chars.length)return;const scrambleChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.";const delayStep=0.2;gsap.set(chars,{opacity:0});const bgTerminalTl=gsap.timeline();chars.forEach((char,i)=>{const originalText=char.textContent||"";bgTerminalTl.fromTo(char,{opacity:0},{opacity:1,scrambleText:{text:originalText,chars:scrambleChars,speed:0.9},duration:fast(3),ease:"power2.inOut"},i*delayStep)});tl.add(bgTerminalTl,"introDone+=0.2")})}
if(icon){const getStrokeLength=(shape)=>{if(!shape||typeof shape.getTotalLength!=="function"){return 0}
try{return shape.getTotalLength()}catch(error){return 0}};const iconShapes=Array.from(icon.querySelectorAll("path, circle, line, polyline, polygon")).filter((shape)=>{const length=getStrokeLength(shape);if(!length)return!1;gsap.set(shape,{strokeDasharray:length,strokeDashoffset:length});return!0});if(iconShapes.length){tl.to(iconShapes,{strokeDashoffset:0,duration:fast(1.2),ease:"power2.out",stagger:0.08},"introDone+=0.2")}
tl.from(icon,{opacity:0,duration:fast(0.6)},"introDone+=0.2")}
tl.add(()=>{animateTerminal("preloader")},"introDone+=0.6");tl.to(preloader,{opacity:0,duration:fast(1),onStart:()=>{animateHeading("hero");animateTerminal("hero")},onComplete:()=>{preloader.style.display="none";if(isPlanets){initOrbitNodes()}}});tl.eventCallback("onComplete",()=>{splitsToRevert.forEach((split)=>{split.revert()})});return tl}
function initModalAnimation(){if(modalAnimationInitialized)return;modalAnimationInitialized=!0;const cssEscape=(value)=>{const str=String(value??"");if(window.CSS&&typeof window.CSS.escape==="function")return window.CSS.escape(str);return str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};const modalTerminalTimelines=new WeakMap();const modalTerminalDelays=new WeakMap();function getModalTimeline(modal){let tl=modalTimelines.get(modal);if(tl)return tl;const overlay=modal.querySelector(".modal__overlay");const svgWrap=modal.querySelector(".modal__svg");const closeBtn=modal.querySelector(".modal__full-close");const card=modal.querySelector(".modal__card");const cardSvg=modal.querySelector(".modal__card-svg");if(overlay)gsap.set(overlay,{opacity:0});if(svgWrap)gsap.set(svgWrap,{clipPath:"inset(0 100% 0 0)"});if(closeBtn){gsap.set(closeBtn,{opacity:0,x:50,filter:"blur(10px)"})}
if(cardSvg){gsap.set(cardSvg,{clipPath:"inset(100% 0 0 0)"})}
if(card){const isMobile=window.matchMedia("(max-width: 767px)").matches;gsap.set(card,{opacity:0,x:isMobile?0:200,y:isMobile?200:0})}
tl=gsap.timeline({paused:!0,defaults:{ease:"power2.out"},onReverseComplete(){modal.classList.remove("active")}});if(overlay)tl.to(overlay,{opacity:1,duration:0.4},0);if(svgWrap)tl.to(svgWrap,{clipPath:"inset(0 0% 0 0)",duration:1.4},0);if(cardSvg)tl.to(cardSvg,{clipPath:"inset(0% 0 0 0)",duration:1.4},0.4);if(card)tl.to(card,{opacity:1,x:0,y:0,duration:0.7},0.25);if(closeBtn)tl.to(closeBtn,{opacity:1,x:0,filter:"blur(0px)",duration:0.4},0.35);tl.progress(0).pause();modalTimelines.set(modal,tl);return tl}
function killTerminalForModal(modal){const delayTween=modalTerminalDelays.get(modal);if(delayTween){delayTween.kill();modalTerminalDelays.delete(modal)}
const terminalTl=modalTerminalTimelines.get(modal);if(terminalTl){terminalTl.kill();modalTerminalTimelines.delete(modal)}}
function normalizeModalType(type){if(type==="advisors")return"advisor";return type}
function updateModalImages(modal,targetKey,modalType){if(!modal||!targetKey||!modalType)return;if(modalType!=="founder"&&modalType!=="advisor")return;const safeKey=cssEscape(targetKey);const allImageLists=modal.querySelectorAll('.modal__image-cms-list[data-modal-type]');allImageLists.forEach((list)=>{const listType=list.getAttribute("data-modal-type");const isActive=listType===modalType;gsap.set(list,{display:isActive?"":"none",autoAlpha:isActive?1:0})});const allImageItems=modal.querySelectorAll('.modal__image-cms-item[data-company-modal-image]');gsap.set(allImageItems,{display:"none",autoAlpha:0});const activeList=modal.querySelector(`.modal__image-cms-list[data-modal-type="${modalType}"]`);if(!activeList)return;const match=activeList.querySelector(`.modal__image-cms-item[data-company-modal-image="${safeKey}"]`);if(match){gsap.set(match,{display:"",autoAlpha:1})}}
function openModal(modal,targetKey,modalTypeRaw){if(!modal)return;const modalType=normalizeModalType(modalTypeRaw);modal.classList.add("active");const allLists=modal.querySelectorAll('.modal__card-cms-list[data-modal-type]');allLists.forEach((list)=>{const listType=list.getAttribute("data-modal-type");const isActive=listType===modalType;const displayValue=listType==="join"?(isActive?"block":"none"):(isActive?"":"none");gsap.set(list,{display:displayValue,autoAlpha:isActive?1:0})});const allItemsWithKeys=modal.querySelectorAll('.modal__card-cms-item[data-modal-content][data-modal-type]');let matchingItems=[];if(allItemsWithKeys.length&&targetKey&&modalType){gsap.set(allItemsWithKeys,{autoAlpha:0,display:"none"});const activeList=modal.querySelector(`.modal__card-cms-list[data-modal-type="${modalType}"]`);if(activeList){const safeKey=cssEscape(targetKey);matchingItems=Array.from(activeList.querySelectorAll(`.modal__card-cms-item[data-modal-type="${modalType}"][data-modal-content="${safeKey}"]`));if(matchingItems.length){matchingItems.forEach((item)=>{const itemType=item.getAttribute("data-modal-type");const displayValue=itemType==="join"?"block":"";gsap.set(item,{display:displayValue,autoAlpha:1})});matchingItems.forEach((item)=>{const headingEl=item.querySelector('[data-text-animation="heading"][data-text-trigger="modal"]');const richTextEl=item.querySelector('.rich-text[data-text-animation="random"][data-text-trigger="modal"]');if(headingEl)gsap.set(headingEl,{visibility:"hidden"});if(richTextEl){gsap.fromTo(richTextEl,{opacity:0},{opacity:1,duration:1.2,delay:0.8,ease:"power2.out"})}});gsap.delayedCall(0.5,()=>{animateHeading("modal")})}}}
updateModalImages(modal,targetKey,modalType);killTerminalForModal(modal);const allTermFrames=modal.querySelectorAll(".modal__card-cms-item .term-frame");gsap.set(allTermFrames,{autoAlpha:0,y:24});const allProgress=modal.querySelectorAll(".modal__card-cms-item .progress");gsap.set(allProgress,{"--pct":0});const allProgressLines=modal.querySelectorAll(".modal__card-cms-item .line.muted.cc-progress");const allDoneLines=modal.querySelectorAll(".modal__card-cms-item .line.muted.cc-done");gsap.set(allProgressLines,{autoAlpha:0,display:"none"});gsap.set(allDoneLines,{autoAlpha:1,display:""});const allTermLines=modal.querySelectorAll(".modal__card-cms-item .term__lines");gsap.set(allTermLines,{clipPath:"inset(0 0 100% 0)",webkitClipPath:"inset(0 0 100% 0)"});let activeContentItems=matchingItems;if(!activeContentItems.length){activeContentItems=Array.from(modal.querySelectorAll(".modal__card-cms-item")).filter((el)=>getComputedStyle(el).display!=="none"&&getComputedStyle(el).visibility!=="hidden")}
const matchingFrames=activeContentItems.map((el)=>el.querySelector(".term-frame")).filter(Boolean);const matchingProgress=activeContentItems.map((el)=>el.querySelector(".progress")).filter(Boolean);const matchingProgressLines=activeContentItems.map((el)=>el.querySelector(".line.muted.cc-progress")).filter(Boolean);const matchingDoneLines=activeContentItems.map((el)=>el.querySelector(".line.muted.cc-done")).filter(Boolean);const matchingTermLines=activeContentItems.map((el)=>el.querySelector(".term__lines")).filter(Boolean);if(matchingFrames.length){gsap.set(matchingFrames,{autoAlpha:0,y:24,willChange:"transform, opacity"})}
if(matchingProgress.length){gsap.set(matchingProgress,{"--pct":0})}
if(matchingProgressLines.length){gsap.set(matchingProgressLines,{autoAlpha:1,display:""})}
if(matchingDoneLines.length){gsap.set(matchingDoneLines,{autoAlpha:0,display:"none"})}
if(matchingTermLines.length){gsap.set(matchingTermLines,{clipPath:"inset(0 0 100% 0)",webkitClipPath:"inset(0 0 100% 0)",willChange:"clip-path"})}
if(matchingFrames.length){const terminalTl=gsap.timeline({paused:!0});terminalTl.to(matchingFrames,{autoAlpha:1,y:0,duration:0.6,stagger:0.06,ease:"power2.out"});if(matchingProgress.length){terminalTl.to(matchingProgress,{"--pct":1,duration:1.1,ease:"none"},">-0.1")}
if(matchingProgressLines.length||matchingDoneLines.length){terminalTl.to(matchingProgressLines,{autoAlpha:0,duration:0.25,ease:"power2.out"},">");terminalTl.set(matchingProgressLines,{display:"none"});terminalTl.set(matchingDoneLines,{display:""});terminalTl.to(matchingDoneLines,{autoAlpha:1,duration:0.25,ease:"power2.out"},"<")}
if(matchingTermLines.length){terminalTl.to(matchingTermLines,{clipPath:"inset(0 0 0% 0)",webkitClipPath:"inset(0 0 0% 0)",duration:0.9,ease:"power2.out",onComplete:()=>{gsap.set(matchingFrames,{willChange:"auto"});gsap.set(matchingTermLines,{willChange:"auto"})}},">")}
modalTerminalTimelines.set(modal,terminalTl);const delayTween=gsap.delayedCall(0.55,()=>terminalTl.play(0));modalTerminalDelays.set(modal,delayTween)}
const tl=getModalTimeline(modal);tl.timeScale(1).play(0)}
function closeModal(modal){if(!modal)return;killTerminalForModal(modal);const visibleContentItems=Array.from(modal.querySelectorAll(".modal__card-cms-item")).filter((el)=>getComputedStyle(el).display!=="none"&&getComputedStyle(el).visibility!=="hidden");const frames=visibleContentItems.map((el)=>el.querySelector(".term-frame")).filter(Boolean);const termLines=visibleContentItems.map((el)=>el.querySelector(".term__lines")).filter(Boolean);if(frames.length||termLines.length){gsap.killTweensOf(frames);gsap.killTweensOf(termLines);if(frames.length){gsap.to(frames,{autoAlpha:0,y:18,duration:0.25,ease:"power2.in",overwrite:!0})}
if(termLines.length){gsap.to(termLines,{clipPath:"inset(0 0 100% 0)",webkitClipPath:"inset(0 0 100% 0)",duration:0.25,ease:"power2.in",overwrite:!0})}}
const tl=modalTimelines.get(modal);if(tl){tl.timeScale(2).reverse()}else{modal.classList.remove("active")}}
function handleDocumentClick(event){const closeEl=event.target.closest("[data-modal-close]");if(closeEl){const modal=closeEl.closest(".modal");if(!modal)return;closeModal(modal);return}
const joinTrigger=event.target.closest("[data-join-modal-trigger]");if(joinTrigger){const modal=document.querySelector(".modal[data-join-modal]");if(!modal)return;event.preventDefault();const targetKey=joinTrigger.getAttribute("data-join-modal-trigger");openModal(modal,targetKey,"join");return}
const docTrigger=event.target.closest("[data-modal-doc-trigger]");if(docTrigger){const modal=document.querySelector(".modal[data-doc-modal]");if(!modal)return;event.preventDefault();openModal(modal,"","doc");return}
const trigger=event.target.closest("[data-modal-trigger][data-modal-type]");if(!trigger)return;event.preventDefault();const targetKey=trigger.getAttribute("data-modal-trigger");const modalType=trigger.getAttribute("data-modal-type");const modal=document.querySelector(".modal[data-modal]");if(!modal)return;openModal(modal,targetKey,modalType)}
function handleKeydown(event){if(event.key==="Escape"||event.key==="Esc"||event.keyCode===27){const openModals=document.querySelectorAll(".modal.active");if(!openModals.length)return;openModals.forEach((modal)=>closeModal(modal))}}
document.addEventListener("click",handleDocumentClick);document.addEventListener("keydown",handleKeydown)}
function initEyebrowAnimation(){const eyebrowBlocks=document.querySelectorAll('[data-animation="eyebrow"]');eyebrowBlocks.forEach((block)=>{const masks=Array.from(block.querySelectorAll("[data-mask]"));if(!masks.length)return;const timeline=gsap.timeline({paused:!0});timeline.to(masks,{clipPath:"inset(0 0% 0 0%)",duration:1,delay:0.5,ease:"power2.out",stagger:0.05},"<");if(typeof ScrollTrigger==="undefined"){timeline.play();return}
ScrollTrigger.create({trigger:block,start:"top bottom",once:!0,onEnter:()=>timeline.play()})})}
function initNavAnimation(){const navElements=document.querySelectorAll('[data-text-animation="nav"]');if(!navElements.length)return;const isDesktop=window.matchMedia("(min-width: 992px)").matches;if(!isDesktop)return;const allDecorationLines=gsap.utils.toArray(".decoration--inner");const fadeInLines=[];const fadeOutLines=[];allDecorationLines.forEach((line)=>{const outer=line.closest(".decoration--outer");const mode=outer?.getAttribute("data-page")||"fade-in";if(mode==="fade-out")fadeOutLines.push(line);else fadeInLines.push(line)});const allChars=[];navElements.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"words,chars",wordsClass:"word",charsClass:"char",autoSplit:!0});allChars.push(...split.chars)});if(!allChars.length)return;gsap.set(allChars,{opacity:1,filter:"blur(0px)"});if(fadeInLines.length)gsap.set(fadeInLines,{autoAlpha:0,filter:"blur(10px)"});if(fadeOutLines.length)gsap.set(fadeOutLines,{autoAlpha:1,filter:"blur(0px)"});const heroSection=document.querySelector(".section.section--hero");const triggerTarget=heroSection||navElements[0];if(!triggerTarget)return;if(!("IntersectionObserver" in window))return;let isAnimating=!1;let pendingState=null;let currentState=null;function runTransition(nextState){isAnimating=!0;pendingState=null;const tl=gsap.timeline({defaults:{ease:"power2.out"},onComplete:()=>{isAnimating=!1;currentState=nextState;if(pendingState&&pendingState!==currentState){runTransition(pendingState)}}});const animateLines=(lines,shouldShow)=>{if(!lines.length)return;tl.to(lines,{autoAlpha:shouldShow?1:0,filter:shouldShow?"blur(0px)":"blur(10px)",duration:shouldShow?0.8:0.6,stagger:0.08,overwrite:"auto"},0)};if(nextState==="hero-in"){tl.to(allChars,{opacity:1,filter:"blur(0px)",duration:0.8,stagger:{each:0.03,from:"start"},overwrite:"auto"},0);animateLines(fadeInLines,!1);animateLines(fadeOutLines,!0)}else{tl.to(allChars,{opacity:0,filter:"blur(10px)",duration:1,stagger:{each:0.03,from:"end"},overwrite:"auto"},0);animateLines(fadeInLines,!0);animateLines(fadeOutLines,!1)}}
function requestState(nextState){if(!isAnimating&&nextState===currentState)return;if(isAnimating){pendingState=nextState;return}
runTransition(nextState)}
const observer=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(entry.target!==triggerTarget)return;requestState(entry.isIntersecting?"hero-in":"hero-out")})},{threshold:0.5});observer.observe(triggerTarget)}
function initBackgroundFadeAnimation(){if(typeof ScrollTrigger==="undefined")return;const bgElements=document.querySelectorAll("[data-animation-bg]");if(!bgElements.length)return;const scrollRoot=document.body||document.documentElement;bgElements.forEach((el)=>{const startOpacity=1;const endOpacity=0.1;gsap.set(el,{opacity:startOpacity,willChange:"opacity"});gsap.to(el,{opacity:endOpacity,ease:"none",scrollTrigger:{trigger:scrollRoot,start:"top top",end:()=>"+="+window.innerHeight,scrub:!0,invalidateOnRefresh:!0}})})}
function initHomeDefineAnimation(){if(typeof gsap==="undefined"||typeof ScrollTrigger==="undefined")return;const isDesktop=window.matchMedia("(min-width: 992px)").matches;if(!isDesktop)return;const defineSection=document.querySelector(".home-define__visual");if(!defineSection)return;initDefineState(defineSection);homeDefineScrubActive=!0;const line=defineSection.querySelector(".home-define__line");const circles=gsap.utils.toArray(defineSection.querySelectorAll(".home-define__circle"));const circleImages=circles.map((circle)=>circle.querySelector(".home-define__img")).filter(Boolean);if(line){gsap.set(line,{clipPath:"inset(0 100% 0 0)"})}
circles.forEach((c)=>c.setAttribute("data-orb-ready","false"));gsap.set(circles,{opacity:0,x:50,scale:0.9,pointerEvents:"none"});gsap.set(circleImages,{opacity:0});if(defineBlocksMap){Object.values(defineBlocksMap).forEach((el)=>gsap.set(el,{autoAlpha:0}));if(defineBlocksMap[defineDefaultKey]){gsap.set(defineBlocksMap[defineDefaultKey],{autoAlpha:1})}}
const tl=gsap.timeline({defaults:{ease:"power2.out"}});tl.call(()=>setDefineFromScrub(defineDefaultKey),null,0);if(line){tl.to(line,{clipPath:"inset(0 0% 0 0)",duration:0.35},0)}
const DEFINE_KEYS=["atoms","bits","biology"];circles.forEach((circle,idx)=>{const baseTime=0.5+idx*0.5;const img=circleImages[idx]||circle.querySelector(".home-define__img");const defineKey=DEFINE_KEYS[idx]||circle.getAttribute("data-define-target")||circle.getAttribute("data-define")||circle.dataset.defineTarget||circle.dataset.define||null;tl.to(circle,{opacity:1,x:0,scale:1,duration:0.35,onComplete:()=>{circle.style.pointerEvents="auto";circle.setAttribute("data-orb-ready","true")},onReverseComplete:()=>{circle.style.pointerEvents="none";circle.setAttribute("data-orb-ready","false")}},baseTime);if(img){tl.to(img,{opacity:1,duration:0.25},baseTime+0.05)}
if(defineKey){const defineOffset=idx===2?0.8:0.6;tl.call(()=>setDefineFromScrub(defineKey),null,baseTime+defineOffset)}});ScrollTrigger.create({trigger:defineSection,start:"top center",end:"bottom center",scrub:!0,animation:tl})}
function initIdleEasterEgg(){if(idleEasterEggInitialized)return;idleEasterEggInitialized=!0;const idleState=document.querySelector(".idle-state");if(!idleState)return;const bgLines=idleState.querySelectorAll(".idle__bg-lines");const IDLE_DELAY=900000;const TRIGGER_SELECTOR='[data-text-trigger="idle"]';let isIdleActive=!1;let idleEasterEggTimer;if(bgLines.length){gsap.set(bgLines,{clipPath:"inset(0 100% 0 0)"})}
const activateIdle=()=>{if(isIdleActive)return;isIdleActive=!0;idleState.classList.add("active");if(bgLines.length){gsap.to(bgLines,{clipPath:"inset(0 0% 0 0)",duration:1,ease:"power2.out",stagger:0.08})}
animateHeading("idle");animateTerminal("idle")};const deactivateIdle=()=>{if(!isIdleActive)return;isIdleActive=!1;idleState.classList.remove("active");if(bgLines.length){gsap.set(bgLines,{clipPath:"inset(0 100% 0 0)"})}};const restartIdleTimer=()=>{if(idleEasterEggTimer){clearTimeout(idleEasterEggTimer)}
idleEasterEggTimer=setTimeout(activateIdle,IDLE_DELAY)};const handleActivity=()=>{if(isIdleActive){deactivateIdle()}
restartIdleTimer()};const handleKeydown=(event)=>{if(event.key==="Enter"&&!event.metaKey&&!event.ctrlKey&&!event.altKey&&!event.shiftKey){if(isIdleActive){window.location.href="/documentary";return}else{handleActivity();return}}
handleActivity()};const handlePointerDown=(event)=>{if(!isIdleActive){handleActivity();return}
const triggerEl=event.target.closest(TRIGGER_SELECTOR);if(triggerEl){window.location.href="/documentary"}else{deactivateIdle();restartIdleTimer()}};window.addEventListener("keydown",handleKeydown);window.addEventListener("pointerdown",handlePointerDown,{passive:!0});["mousemove","scroll"].forEach((eventName)=>{window.addEventListener(eventName,handleActivity,{passive:!0})});document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden"){if(idleEasterEggTimer){clearTimeout(idleEasterEggTimer)}
deactivateIdle()}else{restartIdleTimer()}});restartIdleTimer()}
function initFooterTextAnimation(){const footerElements=document.querySelectorAll('[data-text-animation="footer"]');if(!footerElements.length)return;footerElements.forEach((el)=>{if(el.getAttribute("data-footer-split")==="true")return;el.setAttribute("data-footer-split","true");gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"words,chars",wordsClass:"word",charsClass:"char",autoSplit:!0});el._splitFooter=split;gsap.set(split.chars,{opacity:0,filter:"blur(10px)"});ScrollTrigger.create({trigger:el,start:"top bottom",once:!0,invalidateOnRefresh:!0,onEnter:()=>{gsap.to(split.chars,{opacity:1,filter:"blur(0px)",duration:1,ease:"power2.out",stagger:{each:0.03,from:"start"},overwrite:"auto"})}})})}
function initMenuAnimation(){if(menuAnimationInitialized)return;const menu=document.querySelector(".menu");const navMenu=document.querySelector(".nav-menu");if(!menu||!navMenu)return null;menuAnimationInitialized=!0;const bg=menu.querySelector(".menu__bg");const bgTerminalTexts=menu.querySelectorAll('.menu__bg-text [data-text-animation="bg-terminal"]');const lines=menu.querySelectorAll('.menu__lines [data-menu-line]');const menuItems=Array.from(menu.querySelectorAll(".menu__item"));const menuButtons=menu.querySelector(".menu__buttons");if(menuItems.length&&lines.length){const resetHover=()=>{menuItems.forEach((item)=>{item.classList.remove("is-dimmed","is-active")});lines.forEach((path)=>{path.classList.remove("is-highlighted")})};resetHover();menuItems.forEach((item)=>{item.addEventListener("mouseenter",()=>{const lineId=item.getAttribute("data-menu-line");menuItems.forEach((other)=>{if(other===item){other.classList.add("is-active");other.classList.remove("is-dimmed")}else{other.classList.add("is-dimmed");other.classList.remove("is-active")}});lines.forEach((path)=>{const sameLine=path.getAttribute("data-menu-line")===lineId;path.classList.toggle("is-highlighted",sameLine)})});item.addEventListener("mouseleave",(event)=>{const related=event.relatedTarget;const nextItem=related&&related.closest?related.closest(".menu__item"):null;if(!nextItem)resetHover();})});menu.addEventListener("mouseleave",resetHover)}
const openTextEl=navMenu.querySelector(".nav-menu--text.is--open");const closeTextEl=navMenu.querySelector(".nav-menu--text.is--close");const navIcon=navMenu.querySelector(".nav-menu--icon");let navLabelTl=null;if(openTextEl&&closeTextEl&&typeof SplitText!=="undefined"){const openSplit=new SplitText(openTextEl,{type:"chars",charsClass:"char",autoSplit:!0,});const closeSplit=new SplitText(closeTextEl,{type:"chars",charsClass:"char",autoSplit:!0,});const openChars=openSplit.chars;const closeChars=closeSplit.chars;gsap.set([openTextEl,closeTextEl],{visibility:"visible"});gsap.set(openTextEl,{opacity:1});gsap.set(closeTextEl,{opacity:0,filter:"blur(10px)",webkitFilter:"blur(10px)",});gsap.set(openChars,{opacity:1,filter:"blur(0px)",webkitFilter:"blur(0px)"});gsap.set(closeChars,{opacity:0});const iconRects=navIcon?navIcon.querySelectorAll("rect"):null;if(iconRects&&iconRects.length>=2){gsap.set(iconRects,{transformOrigin:"50% 50%",rotation:0,y:0})}
navLabelTl=gsap.timeline({paused:!0});navLabelTl.to(openTextEl,{opacity:0,duration:0.25,ease:"power2.in",},0);navLabelTl.to(closeTextEl,{opacity:1,filter:"blur(0px)",webkitFilter:"blur(0px)",duration:0.3,ease:"power2.out",},0.05);navLabelTl.to(openChars,{opacity:0,filter:"blur(10px)",webkitFilter:"blur(10px)",duration:0.25,ease:"power2.in",stagger:{each:0.03,from:"start"},},0);navLabelTl.fromTo(closeChars,{opacity:0},{opacity:1,duration:0.3,ease:"power2.out",stagger:{each:0.03,from:"start"},},0.07);if(iconRects&&iconRects.length>=2){const topRect=iconRects[0];const bottomRect=iconRects[1];navLabelTl.to(topRect,{y:-3,rotation:45,duration:0.3,ease:"power2.inOut"},0);navLabelTl.to(bottomRect,{y:3,rotation:-45,duration:0.3,ease:"power2.inOut"},0)}}
const contentTl=gsap.timeline({defaults:{ease:"power2.out"},paused:!0,});if(bg){gsap.set(bg,{opacity:0});contentTl.to(bg,{opacity:1,duration:0.5},0)}
if(bgTerminalTexts.length){bgTerminalTexts.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"chars",charsClass:"char",wordsClass:"word",autoSplit:!0,});const chars=split.chars.filter((c)=>c.textContent.trim());if(!chars.length)return;const scrambleChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.";const delayStep=0.2;const originals=chars.map((c)=>c.textContent||"");chars.forEach((c,i)=>(c.dataset.originalText=originals[i]));gsap.set(chars,{opacity:0});const bgTerminalTl=gsap.timeline();chars.forEach((char,i)=>{const originalText=originals[i];bgTerminalTl.fromTo(char,{opacity:0},{opacity:1,scrambleText:{text:originalText,chars:scrambleChars,speed:0.9,},duration:2.5,ease:"power2.inOut",},i*delayStep)});bgTerminalTl.addLabel("revealEnd");const subtleLoop=gsap.timeline({repeat:-1,repeatDelay:3});subtleLoop.add(()=>{if(!chars.length)return;const maxPerWave=Math.min(4,chars.length);const count=Math.max(1,Math.round(maxPerWave*0.5));const shuffled=gsap.utils.shuffle(chars.slice());const subset=shuffled.slice(0,count);subset.forEach((char,j)=>{const originalText=char.dataset.originalText||char.textContent||"";gsap.to(char,{scrambleText:{text:originalText,chars:scrambleChars,speed:0.8,},duration:0.35,ease:"power1.inOut",delay:j*0.03,})})});bgTerminalTl.add(subtleLoop,"revealEnd+=0.5");contentTl.add(bgTerminalTl,0.2)})}
if(lines.length){const sortedLines=Array.from(lines).sort((a,b)=>{const na=parseInt(a.getAttribute("data-menu-line")||"0",10);const nb=parseInt(b.getAttribute("data-menu-line")||"0",10);return na-nb});sortedLines.forEach((path,index)=>{const length=path.getTotalLength();gsap.set(path,{strokeDasharray:length,strokeDashoffset:length,});contentTl.to(path,{strokeDashoffset:0,duration:0.9,ease:"power2.out",},0.25+index*0.12)})}
if(menuItems.length){const reversedItems=menuItems.slice().reverse();reversedItems.forEach((item,itemIndex)=>{const baseTime=0.5+itemIndex*0.2;const touchpointSvg=item.querySelector(".touchpoint-svg");const eyebrowMask=item.querySelector('.eyebrow__mask[data-mask="right"]');const randomText=item.querySelector('[data-text-animation="random"][data-text-trigger="menu"]');const menuTitle=item.querySelector('[data-text-animation="menu-title"][data-text-trigger="menu"]');if(touchpointSvg){contentTl.from(touchpointSvg,{opacity:0,scale:0.95,duration:0.4,ease:"power2.out",transformOrigin:"50% 50%",},baseTime-0.08)}
if(eyebrowMask){gsap.set(eyebrowMask,{clipPath:"inset(0 100% 0 0)"});contentTl.to(eyebrowMask,{clipPath:"inset(0 0% 0 0)",duration:0.6,ease:"power2.out",},baseTime)}
if(randomText){gsap.set(randomText,{visibility:"visible"});const splitRandom=new SplitText(randomText,{type:"chars",charsClass:"char",wordsClass:"word",autoSplit:!0,});contentTl.fromTo(splitRandom.chars,{opacity:0},{opacity:1,duration:0.5,ease:"power2.out",stagger:{each:0.02,from:"random"},},baseTime+0.04)}
if(menuTitle){gsap.set(menuTitle,{visibility:"visible"});const splitTitle=new SplitText(menuTitle,{type:"chars",charsClass:"char",wordsClass:"word",autoSplit:!0,});contentTl.fromTo(splitTitle.chars,{opacity:0,filter:"blur(10px)",webkitFilter:"blur(10px)"},{opacity:1,filter:"blur(0px)",webkitFilter:"blur(0px)",duration:0.6,ease:"power2.out",stagger:0.03,},baseTime+0.08)}})}
if(menuButtons){gsap.set(menuButtons,{opacity:0});contentTl.to(menuButtons,{opacity:1,duration:0.5,ease:"power2.out",},0.5+menuItems.length*0.2)}
let menuOpen=!1;gsap.set(menu,{autoAlpha:0,display:"none"});navMenu.addEventListener("click",()=>{gsap.killTweensOf(menu);if(!menuOpen){gsap.set(menu,{display:"block"});gsap.fromTo(menu,{autoAlpha:0},{autoAlpha:1,duration:0.4,ease:"power2.out",});contentTl.timeScale(1.2).restart();if(navLabelTl)navLabelTl.timeScale(1).play();menuOpen=!0}else{contentTl.timeScale(2.5).reverse();gsap.to(menu,{autoAlpha:0,duration:0.6,ease:"power2.out",onComplete:()=>{gsap.set(menu,{display:"none"});menuOpen=!1},});if(navLabelTl)navLabelTl.timeScale(2).reverse();}});return contentTl}
let pageTransitionInitialized=!1;function initPageTransition(){if(pageTransitionInitialized)return;pageTransitionInitialized=!0;const overlay=document.querySelector(".page-transition");if(!overlay||typeof gsap==="undefined")return;const TRANSITION_DURATION=0.5;overlay.style.pointerEvents="auto";window.addEventListener("load",()=>{gsap.to(overlay,{opacity:0,duration:TRANSITION_DURATION,overwrite:"auto",onComplete:()=>{overlay.style.pointerEvents="none"},})});document.addEventListener("click",(event)=>{const link=event.target.closest("a[href]");if(!link)return;const href=link.getAttribute("href");if(!href)return;if(event.defaultPrevented||event.button!==0||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey){return}
if(link.target==="_blank"||href.startsWith("#")||href.startsWith("mailto:")||href.startsWith("tel:")||link.hasAttribute("download")||link.hasAttribute("data-no-transition")){return}
const url=new URL(href,window.location.href);if(url.origin!==window.location.origin){return}
event.preventDefault();overlay.style.pointerEvents="auto";gsap.to(overlay,{opacity:1,duration:TRANSITION_DURATION,overwrite:"auto",onComplete:()=>{window.location.href=href},})})}
function initHeroAnimation(){const heroHeadings=document.querySelectorAll('[data-text-animation="heading"][data-text-trigger="page-hero"]');heroHeadings.forEach((el)=>{gsap.set(el,{visibility:"visible"});const split=new SplitText(el,{type:"lines, words, chars",linesClass:"line",charsClass:"char",wordsClass:"word",autoSplit:!0});const duration=parseFloat(el.getAttribute("data-text-duration"))||0.9;const delay=parseFloat(el.getAttribute("data-text-delay"))||0;const hasGradient=el.dataset.textGradient==="true";const gradientFrom=el.dataset.textGradientFrom||"#FEFEFE";const gradientTo=el.dataset.textGradientTo||"#635345";const colorInterpolator=hasGradient?gsap.utils.interpolate(gradientFrom,gradientTo):null;const tl=gsap.timeline({delay,onComplete:()=>{if(!hasGradient){split.revert()}}});split.lines.forEach((line)=>{const lineChars=split.chars.filter((char)=>line.contains(char));if(!lineChars.length)return;if(hasGradient&&colorInterpolator){const total=Math.max(lineChars.length-1,1);lineChars.forEach((char,index)=>{const ratio=index/total;const targetColor=colorInterpolator(ratio);gsap.set(char,{color:targetColor})})}
tl.from(lineChars,{duration,opacity:0,filter:"blur(10px)",ease:"power2.out",stagger:0.05},0)})});const heroTerminals=document.querySelectorAll('[data-text-animation="terminal"][data-text-trigger="page-hero"]');heroTerminals.forEach((el)=>{gsap.set(el,{autoAlpha:1,visibility:"visible"});const split=new SplitText(el,{type:"words,chars",charsClass:"char",wordsClass:"word",autoSplit:!0});const chars=split.chars;if(!chars.length)return;const delayAttr=el.getAttribute("data-text-delay")||"0";const durationAttr=el.getAttribute("data-text-duration")||el.getAttribute("data-text-duration-seconds")||"1.8";const delay=parseFloat(delayAttr)||0;const charDuration=parseFloat(durationAttr)||1.8;const charStagger=0.035;const cursorBlinkDuration=0.15;const cursorBlinkRepeats=4;const cursorFadeDuration=charDuration*0.7;const scrambleChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.";const lastIndex=chars.length-1;const textNodes=chars.map((char)=>{if(char.__terminalTextNode&&char.contains(char.__terminalTextNode)){return char.__terminalTextNode}
const textSpan=document.createElement("span");textSpan.className="terminal-char__text";textSpan.textContent=char.textContent||"";char.textContent="";char.appendChild(textSpan);char.__terminalTextNode=textSpan;return textSpan});gsap.set(textNodes,{autoAlpha:0});chars.forEach((char)=>{char.style.setProperty("--terminal-cursor-opacity","0")});let currentCursorIndex=null;let hasReverted=!1;const setCursor=(targetIndex)=>{if(typeof currentCursorIndex==="number"&&chars[currentCursorIndex]){chars[currentCursorIndex].style.setProperty("--terminal-cursor-opacity","0");const previousTextNode=textNodes[currentCursorIndex];if(previousTextNode){gsap.to(previousTextNode,{autoAlpha:0.4,duration:0.2,ease:"power2.out",onComplete:()=>{gsap.to(previousTextNode,{autoAlpha:1,duration:0.2,ease:"power2.out"})}})}}
if(typeof targetIndex==="number"&&chars[targetIndex]){chars[targetIndex].style.setProperty("--terminal-cursor-opacity","1");currentCursorIndex=targetIndex}else{currentCursorIndex=null}};const cleanup=()=>{if(hasReverted)return;hasReverted=!0;setCursor(null);split.revert()};const tl=gsap.timeline({delay,defaults:{duration:charDuration,ease:"power2.out"}});textNodes.forEach((textNode,index)=>{tl.to(textNode,{scrambleText:{text:"{original}",chars:scrambleChars,speed:0.55},onStart:()=>{setCursor(index);gsap.set(textNode,{autoAlpha:1})}},index*charStagger)});const lastCharStart=lastIndex*charStagger;const cursorBlinkTl=gsap.timeline();cursorBlinkTl.to(chars[lastIndex],{duration:cursorBlinkDuration,"--terminal-cursor-opacity":0,repeat:cursorBlinkRepeats,yoyo:!0,ease:"none"}).to(chars[lastIndex],{duration:cursorFadeDuration,"--terminal-cursor-opacity":0,ease:"power1.inOut",onComplete:cleanup});tl.add(()=>setCursor(lastIndex),lastCharStart);tl.add(cursorBlinkTl,lastCharStart);tl.play(0)})}
function initMetricScrubber(){if(typeof gsap==="undefined"||typeof ScrollTrigger==="undefined")return;const blocks=document.querySelectorAll("[data-metric-scrubber]");if(!blocks.length)return;const DISTANCE_MILESTONES=[{value:"~100,000 ly",caption:"Galactic Scale"},{value:"~10,000 ly",caption:"Spiral Arm"},{value:"~1,000 ly",caption:"Stellar Nursery"},{value:"~100 ly",caption:"Star Cluster"},{value:"~1 ly",caption:"Interstellar Neighborhood"},{value:"1 Å",caption:"Atomic Scale"},{value:"3 nm",caption:"Circuit Scale"},{value:"10 µm",caption:"Cellular Scale"},{value:"∞",caption:"Infinite"}];blocks.forEach((block)=>{const scrubberType=block.getAttribute("data-metric-scrubber")||"home";const valueEl=block.querySelector("[data-metric-value]");const captionEls=gsap.utils.toArray(block.querySelectorAll("[data-metric-caption]"));const lines=gsap.utils.toArray(block.querySelectorAll("[data-metric-line]"));if(!valueEl||!lines.length)return;let isOverrideActive=!1;let pendingMilestoneIndex=null;const linePositions=[];function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
function computePositions(){linePositions.length=0;const blockRect=block.getBoundingClientRect();lines.forEach((line)=>{const rect=line.getBoundingClientRect();const centerY=rect.top-blockRect.top+rect.height/2;linePositions.push(centerY)})}
function setActiveLine(index){lines.forEach((line,i)=>line.classList.toggle("is-active",i===index))}
computePositions();const setValueY=gsap.quickTo(valueEl,"y",{duration:0.3,ease:"power2.out"});function moveMarkerToLine(lineIndex){const idx=clamp(lineIndex,0,lines.length-1);setActiveLine(idx);const y=linePositions[idx];if(y!=null)setValueY(y);}
function applyValue(value,caption){if(value!=null)valueEl.textContent=value;if(captionEls.length&&caption!=null){const words=caption.trim().split(/\s+/);if(captionEls.length>=2&&words.length===2){captionEls[0].textContent=words[0];captionEls[1].textContent=words[1]}else if(captionEls.length>=2&&words.length===1){captionEls[0].textContent=words[0];captionEls[1].textContent=""}else if(captionEls.length===1){captionEls[0].textContent=caption}else{captionEls[0].textContent=caption;if(captionEls[1])captionEls[1].textContent=""}}}
if(scrubberType==="about"){const currentYear=new Date().getFullYear();const TIMELINE_MILESTONES=[{years:0,caption:"Day Zero"},{years:2,caption:"MVP Scale"},{years:10,caption:"Products Launch"},{years:25,caption:"Mars Thriving"},{years:50,caption:"System Industrialized"},{years:75,caption:"Dyson Construction"},{years:100,caption:"Beyond Solar"}].map((m)=>({year:currentYear+m.years,caption:m.caption}));moveMarkerToLine(0);applyValue(TIMELINE_MILESTONES[0].year,TIMELINE_MILESTONES[0].caption);let lastLineIndex=0;let lastLabel=TIMELINE_MILESTONES[0].year;let lastCaption=TIMELINE_MILESTONES[0].caption;ScrollTrigger.create({start:0,end:"max",scrub:!0,onUpdate(self){const progress=self.progress;const maxLine=lines.length-1;const lineIndex=clamp(Math.round(progress*maxLine),0,maxLine);if(lineIndex!==lastLineIndex){moveMarkerToLine(lineIndex);lastLineIndex=lineIndex}
const milestoneIndex=clamp(Math.floor(progress*TIMELINE_MILESTONES.length),0,TIMELINE_MILESTONES.length-1);const milestone=TIMELINE_MILESTONES[milestoneIndex];if(milestone.year!==lastLabel||milestone.caption!==lastCaption){applyValue(milestone.year,milestone.caption);lastLabel=milestone.year;lastCaption=milestone.caption}}});window.addEventListener("resize",()=>{computePositions();ScrollTrigger.refresh()});return}
if(scrubberType==="planet"){const wrapper=document.querySelector(".scroll-sections-wrapper");const sections=wrapper?Array.from(wrapper.querySelectorAll(".scroll-section")):[];const COMPANY_NAV_WRAP=document.querySelector(".company-nav__items");function getActiveCompanyRef(){const active=document.querySelector(".company-nav__items .company-nav__item.is-active");const ref=active?.getAttribute("data-company-ref")||active?.dataset?.companyRef||null;return ref?String(ref).trim():null}
const STATIC_STATES={orbit:{value:"ORBIT",caption:"Holding Pattern"},transition:{value:"4.2ly",caption:"LIGHTSPEED"}};function sectionIndexToLineIndex(sectionIndex){if(!sections.length||sections.length<=1)return 0;const t=sectionIndex/(sections.length-1);return Math.round(t*(lines.length-1))}
let lastStateKey=null;function resolveState(key){if(key==="earth"){return{value:getActiveCompanyRef()||"EARTH",caption:"Homeworld"}}
if(key==="proxima"){return{value:getActiveCompanyRef()||"PROXIMA",caption:"New World"}}
return STATIC_STATES[key]||STATIC_STATES.orbit}
function setState(key,force=!1){if(!force&&key===lastStateKey)return;const state=resolveState(key);applyValue(state.value,state.caption);lastStateKey=key}
function stateKeyFromEra(era){if(era==="earth")return"earth";if(era==="transition")return"transition";if(era==="proxima")return"proxima";return"orbit"}
function setFromSection(section,index){const era=section?.getAttribute("data-era");const key=stateKeyFromEra(era);setState(key);moveMarkerToLine(sectionIndexToLineIndex(index))}
setState("orbit",!0);moveMarkerToLine(0);if(!sections.length){window.addEventListener("resize",()=>{computePositions();ScrollTrigger.refresh()});return}
const firstSection=sections[0];ScrollTrigger.create({trigger:firstSection,start:"top center",onLeaveBack:()=>{setState("orbit",!0);moveMarkerToLine(0)}});sections.forEach((section,i)=>{ScrollTrigger.create({trigger:section,start:"top center",end:"bottom center",onEnter:()=>setFromSection(section,i),onEnterBack:()=>setFromSection(section,i)})});function setInitialPlanetState(){const probeY=(window.innerHeight||0)*0.5;let activeIndex=-1;for(let i=0;i<sections.length;i++){const r=sections[i].getBoundingClientRect();if(r.top<=probeY&&r.bottom>=probeY){activeIndex=i;break}}
if(activeIndex===-1){setState("orbit",!0);moveMarkerToLine(0)}else{setFromSection(sections[activeIndex],activeIndex)}}
if(COMPANY_NAV_WRAP){let rafId=null;const scheduleNavSync=()=>{if(rafId!=null)return;rafId=requestAnimationFrame(()=>{rafId=null;if(lastStateKey==="earth"||lastStateKey==="proxima"){setState(lastStateKey,!0)}})};const mo=new MutationObserver((mutations)=>{for(const m of mutations){if(m.type==="attributes"&&m.attributeName==="class"){scheduleNavSync();break}}});mo.observe(COMPANY_NAV_WRAP,{attributes:!0,subtree:!0,attributeFilter:["class"]});scheduleNavSync()}
ScrollTrigger.addEventListener("refresh",setInitialPlanetState);ScrollTrigger.refresh();setInitialPlanetState();window.addEventListener("resize",()=>{computePositions();ScrollTrigger.refresh()});return}
const MILESTONES=DISTANCE_MILESTONES;moveMarkerToLine(0);applyValue(MILESTONES[0].value,MILESTONES[0].caption);let currentMilestoneIndex=0;let lastValue=MILESTONES[0].value;let lastCaption=MILESTONES[0].caption;function applyMilestone(index){const idx=clamp(index,0,MILESTONES.length-1);const milestone=MILESTONES[idx];const lineIndex=clamp(Math.round((idx/(MILESTONES.length-1))*(lines.length-1)),0,lines.length-1);moveMarkerToLine(lineIndex);if(milestone.value!==lastValue||milestone.caption!==lastCaption){applyValue(milestone.value,milestone.caption);lastValue=milestone.value;lastCaption=milestone.caption}}
function setMilestone(index){const idx=clamp(index,0,MILESTONES.length-1);currentMilestoneIndex=idx;if(isOverrideActive){pendingMilestoneIndex=idx;return}
applyMilestone(idx)}
function forceMilestone(index){const idx=clamp(index,0,MILESTONES.length-1);applyMilestone(idx)}
const deepSection=document.querySelector('[data-scrubber-section="deep"]');if(deepSection){ScrollTrigger.create({trigger:document.body,start:"top top",end:()=>{const deepTop=deepSection.offsetTop;const viewportCenter=window.innerHeight/2;return `${deepTop - viewportCenter}px top`},scrub:!0,onUpdate(self){const progress=self.progress;const milestoneIndex=clamp(Math.floor(progress*4),0,3);setMilestone(milestoneIndex)}});ScrollTrigger.create({trigger:deepSection,start:"top center",onEnter:()=>setMilestone(4),onEnterBack:()=>setMilestone(4),onLeaveBack:()=>setMilestone(3)})}else{ScrollTrigger.create({trigger:document.body,start:"top top",end:"30% top",scrub:!0,onUpdate(self){const progress=self.progress;const milestoneIndex=clamp(Math.floor(progress*4),0,3);setMilestone(milestoneIndex)}})}
const defineSection=document.querySelector(".home-define__visual");if(defineSection){ScrollTrigger.create({trigger:defineSection,start:"top center",end:"bottom center",onUpdate:(self)=>{const progress=self.progress;if(progress<0.25)setMilestone(4);else if(progress<0.5)setMilestone(5);else if(progress<0.75)setMilestone(6);else if(progress<0.95)setMilestone(7);else setMilestone(8)},onLeaveBack:()=>{if(deepSection)setMilestone(4);}})}
ScrollTrigger.create({start:"bottom bottom",end:"max",onEnter:()=>setMilestone(MILESTONES.length-1)});const scaleMap=[{selector:"[data-scale-1]",milestoneIndex:5},{selector:"[data-scale-2]",milestoneIndex:6},{selector:"[data-scale-3]",milestoneIndex:7}];const scaleEls=scaleMap.map((m)=>({...m,els:Array.from(document.querySelectorAll(m.selector))})).filter((m)=>m.els.length);const anyScaleSelector="[data-scale-1],[data-scale-2],[data-scale-3]";function canInteract(el){if(el.hasAttribute("data-orb-ready")){return el.getAttribute("data-orb-ready")==="true"}
return!0}
function beginOverride(milestoneIndex){isOverrideActive=!0;forceMilestone(milestoneIndex)}
function endOverride(){isOverrideActive=!1;const idx=pendingMilestoneIndex!=null?pendingMilestoneIndex:currentMilestoneIndex;pendingMilestoneIndex=null;applyMilestone(idx)}
if(scaleEls.length){scaleEls.forEach(({els,milestoneIndex})=>{els.forEach((el)=>{el.addEventListener("pointerenter",()=>{if(!canInteract(el))return;beginOverride(milestoneIndex)});el.addEventListener("pointerleave",(e)=>{const next=e.relatedTarget;if(next&&next.closest&&next.closest(anyScaleSelector))return;endOverride()});el.addEventListener("focus",()=>{if(!canInteract(el))return;beginOverride(milestoneIndex)});el.addEventListener("blur",()=>endOverride())})})}
window.addEventListener("resize",()=>{computePositions();ScrollTrigger.refresh()})})}
function initOrbitNodes(){const orbit=document.querySelector(".hero__orbit");const allNodes=gsap.utils.toArray(".orbit__node");const pathSelector="#orbitPath";if(!orbit||!allNodes.length||!document.querySelector(pathSelector))return;const VISIBLE_COUNT=Math.min(4,allNodes.length);const visibleNodes=allNodes.slice(0,VISIBLE_COUNT);const hiddenNodes=allNodes.slice(VISIBLE_COUNT);const isFirstRun=orbit.dataset.orbitAnimated!=="1";allNodes.forEach((node)=>{if(node._orbitTween){node._orbitTween.kill();node._orbitTween=null}});gsap.set(hiddenNodes,{autoAlpha:0,display:"none",pointerEvents:"none"});const totalVisible=visibleNodes.length;if(!totalVisible)return;visibleNodes.forEach((node,index)=>{const t=index/totalVisible;node.dataset.orbitT=t;if(isFirstRun){gsap.set(node,{opacity:0})}
const tween=gsap.to(node,{duration:60,repeat:-1,ease:"none",motionPath:{path:pathSelector,align:pathSelector,alignOrigin:[0.5,0.5],start:t,end:t+1},paused:!0});tween.progress(0).pause();node._orbitTween=tween});function startOrbitLoop(){visibleNodes.forEach((node)=>{if(node._orbitTween){node._orbitTween.play()}})}
if(isFirstRun){orbit.dataset.orbitAnimated="1";const tl=gsap.timeline({onComplete:startOrbitLoop});tl.to(orbit,{clipPath:"inset(0 0% 0 0)",duration:1,ease:"power2.out"});tl.to(visibleNodes,{opacity:1,duration:0.6,ease:"power2.out",stagger:0.08},"-=0.4")}else{gsap.set(visibleNodes,{opacity:1});startOrbitLoop()}}
window.addEventListener("resize",initOrbitNodes);function initFounderAsciiReveal(){if(window.matchMedia("(max-width: 991px)").matches)return;const founders=document.querySelectorAll(".founder__item");if(founders.length){founders.forEach((item)=>{const img=item.querySelector(".founder__ascii-image");if(!img)return;item.addEventListener("mouseenter",()=>{img.classList.add("is-active")});item.addEventListener("mouseleave",()=>{img.classList.remove("is-active")});item.addEventListener("mousemove",(event)=>{const rect=item.getBoundingClientRect();const x=((event.clientX-rect.left)/rect.width)*100;const y=((event.clientY-rect.top)/rect.height)*100;img.style.setProperty("--maskX",`${x}%`);img.style.setProperty("--maskY",`${y}%`)})})}
const modalAsciiImages=document.querySelectorAll(".modal__card-image.is-ascii");modalAsciiImages.forEach((img)=>{const target=img.closest(".modal__card-image-wrap")||img;target.addEventListener("mouseenter",()=>{img.classList.add("is-active")});target.addEventListener("mouseleave",()=>{img.classList.remove("is-active")});target.addEventListener("mousemove",(event)=>{const rect=target.getBoundingClientRect();const x=((event.clientX-rect.left)/rect.width)*100;const y=((event.clientY-rect.top)/rect.height)*100;img.style.setProperty("--maskX",`${x}%`);img.style.setProperty("--maskY",`${y}%`)})})}
function animateHeadingOnScroll(el){if(!el)return;if(el.dataset.headingAnimated==="true")return;el.dataset.headingAnimated="true";const split=new SplitText(el,{type:"lines, words, chars",linesClass:"line",charsClass:"char",wordsClass:"word",autoSplit:!0});const duration=parseFloat(el.getAttribute("data-text-duration"))||0.9;const delay=parseFloat(el.getAttribute("data-text-delay"))||0;const hasGradient=el.dataset.textGradient==="true";const gradientFrom=el.dataset.textGradientFrom||"#FEFEFE";const gradientTo=el.dataset.textGradientTo||"#635345";const colorInterpolator=hasGradient?gsap.utils.interpolate(gradientFrom,gradientTo):null;gsap.set(el,{autoAlpha:1});gsap.set(split.chars,{opacity:0,filter:"blur(10px)"});const tl=gsap.timeline({delay,onComplete:()=>{if(!hasGradient){split.revert()}}});split.lines.forEach((line)=>{const lineChars=split.chars.filter((char)=>line.contains(char));if(!lineChars.length)return;if(hasGradient&&colorInterpolator){const total=Math.max(lineChars.length-1,1);lineChars.forEach((char,index)=>{const ratio=index/total;const targetColor=colorInterpolator(ratio);gsap.set(char,{color:targetColor})})}
tl.to(lineChars,{opacity:1,filter:"blur(0px)",duration,ease:"power2.out",stagger:0.05},0)});return tl}
function initHeadingScrollAnimation(){if(typeof ScrollTrigger==="undefined")return;const elements=gsap.utils.toArray('[data-text-animation="heading"][data-text-trigger="scroll"]');if(!elements.length)return;gsap.set(elements,{visibility:"hidden"});elements.forEach((el)=>{ScrollTrigger.create({trigger:el,start:"top 80%",once:!0,onEnter:()=>{gsap.set(el,{visibility:"visible"});animateHeadingOnScroll(el)}})})}
function animateTerminalOnScroll(el){if(!el)return;if(el.dataset.terminalAnimated==="true")return;el.dataset.terminalAnimated="true";gsap.set(el,{autoAlpha:1,visibility:"visible"});const split=new SplitText(el,{type:"words,chars",charsClass:"char",wordsClass:"word",autoSplit:!0});const chars=split.chars;if(!chars.length)return;const delayAttr=el.getAttribute("data-text-delay")||"0";const durationAttr=el.getAttribute("data-text-duration")||el.getAttribute("data-text-duration-seconds")||"1.8";const delay=parseFloat(delayAttr)||0;const charDuration=parseFloat(durationAttr)||1.8;const charStagger=0.035;const cursorBlinkDuration=0.15;const cursorBlinkRepeats=4;const cursorFadeDuration=charDuration*0.7;const scrambleChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.";const lastIndex=chars.length-1;const textNodes=chars.map((char)=>{if(char.__terminalTextNode&&char.contains(char.__terminalTextNode)){return char.__terminalTextNode}
const textSpan=document.createElement("span");textSpan.className="terminal-char__text";textSpan.textContent=char.textContent||"";char.textContent="";char.appendChild(textSpan);char.__terminalTextNode=textSpan;return textSpan});gsap.set(textNodes,{autoAlpha:0});chars.forEach((char)=>{char.style.setProperty("--terminal-cursor-opacity","0")});let currentCursorIndex=null;let hasReverted=!1;const setCursor=(targetIndex)=>{if(typeof currentCursorIndex==="number"&&chars[currentCursorIndex]){chars[currentCursorIndex].style.setProperty("--terminal-cursor-opacity","0");const previousTextNode=textNodes[currentCursorIndex];if(previousTextNode){gsap.to(previousTextNode,{autoAlpha:0.4,duration:0.2,ease:"power2.out",onComplete:()=>{gsap.to(previousTextNode,{autoAlpha:1,duration:0.2,ease:"power2.out"})}})}}
if(typeof targetIndex==="number"&&chars[targetIndex]){chars[targetIndex].style.setProperty("--terminal-cursor-opacity","1");currentCursorIndex=targetIndex}else{currentCursorIndex=null}};const cleanup=()=>{if(hasReverted)return;hasReverted=!0;setCursor(null);split.revert()};const tl=gsap.timeline({delay,defaults:{duration:charDuration,ease:"power2.out"}});textNodes.forEach((textNode,index)=>{tl.to(textNode,{scrambleText:{text:"{original}",chars:scrambleChars,speed:0.55},onStart:()=>{setCursor(index);gsap.set(textNode,{autoAlpha:1})}},index*charStagger)});const lastCharStart=lastIndex*charStagger;const cursorBlinkTl=gsap.timeline();cursorBlinkTl.to(chars[lastIndex],{duration:cursorBlinkDuration,"--terminal-cursor-opacity":0,repeat:cursorBlinkRepeats,yoyo:!0,ease:"none"}).to(chars[lastIndex],{duration:cursorFadeDuration,"--terminal-cursor-opacity":0,ease:"power1.inOut",onComplete:cleanup});tl.add(()=>setCursor(lastIndex),lastCharStart);tl.add(cursorBlinkTl,lastCharStart);tl.play(0);return tl}
function initTerminalScrollAnimation(){if(typeof ScrollTrigger==="undefined")return;const elements=gsap.utils.toArray('[data-text-animation="terminal"][data-text-trigger="scroll"]');if(!elements.length)return;gsap.set(elements,{autoAlpha:0});elements.forEach((el)=>{ScrollTrigger.create({trigger:el,start:"top 80%",once:!0,onEnter:()=>{animateTerminalOnScroll(el)}})})}
function initHighlightText(){let splitHeadingTargets=document.querySelectorAll("[data-text-animation='highlight']")
splitHeadingTargets.forEach((heading)=>{const scrollStart=heading.getAttribute("data-text-trigger='scroll'")||"top 70%"
const scrollEnd=heading.getAttribute("data-highlight-scroll-end")||"center 40%"
const fadedValue=heading.getAttribute("data-highlight-fade")||0.2
const staggerValue=heading.getAttribute("data-highlight-stagger")||0.1
new SplitText(heading,{type:"words, chars",autoSplit:!0,onSplit(self){let ctx=gsap.context(()=>{let tl=gsap.timeline({scrollTrigger:{scrub:!0,trigger:heading,start:scrollStart,end:scrollEnd,}})
tl.from(self.chars,{autoAlpha:fadedValue,stagger:staggerValue,ease:"linear"})});return ctx}})})}
function animateRandomOnScroll(el){if(!el)return;if(el.dataset.randomAnimated==="true")return;el.dataset.randomAnimated="true";gsap.set(el,{visibility:"visible",autoAlpha:1});const split=new SplitText(el,{type:"words, chars",charsClass:"char",wordsClass:"word",autoSplit:!0});const duration=parseFloat(el.getAttribute("data-text-duration"))||0.6;const delay=parseFloat(el.getAttribute("data-text-delay"))||0;gsap.set(split.chars,{opacity:0});const tl=gsap.to(split.chars,{opacity:1,duration,delay,ease:"power2.out",stagger:{each:0.004,from:"random"},onComplete:()=>split.revert()});return tl}
function initRandomScrollAnimation(){if(typeof ScrollTrigger==="undefined")return;const elements=gsap.utils.toArray('[data-text-animation="random"][data-text-trigger="scroll"]');if(!elements.length)return;gsap.set(elements,{autoAlpha:0});elements.forEach((el)=>{ScrollTrigger.create({trigger:el,start:"top 80%",once:!0,onEnter:()=>{animateRandomOnScroll(el)}})})}
function initCompanyNavMobileCentering(){const mq=window.matchMedia("(max-width: 991px)");let observer=null;let rafId=null;const track=document.querySelector(".company-nav__track");if(!track)return;const itemsWrap=track.querySelector(".company-nav__items");if(!itemsWrap)return;gsap.set(itemsWrap,{willChange:"transform"});function isVisible(el){return!!(el&&el.getClientRects&&el.getClientRects().length)}
function resetPosition(animate=!0){if(animate){gsap.to(itemsWrap,{x:0,duration:0.5,ease:"power3.out"})}else{gsap.set(itemsWrap,{x:0})}}
function clampX(x){const trackW=track.getBoundingClientRect().width;const contentW=itemsWrap.scrollWidth;if(contentW<=trackW)return 0;const minX=trackW-contentW;const maxX=0;return Math.max(minX,Math.min(maxX,x))}
function centerActive(animate=!0){if(!isVisible(track))return;const active=itemsWrap.querySelector(".company-nav__item.is-active");if(!active){resetPosition(animate);return}
const trackRect=track.getBoundingClientRect();const activeRect=active.getBoundingClientRect();const trackCenter=trackRect.left+trackRect.width/2;const activeCenter=activeRect.left+activeRect.width/2;const currentX=gsap.getProperty(itemsWrap,"x")||0;const nextX=clampX(currentX+(trackCenter-activeCenter));if(animate){gsap.to(itemsWrap,{x:nextX,duration:0.6,ease:"power3.out"})}else{gsap.set(itemsWrap,{x:nextX})}}
function scheduleCenter(){if(rafId)cancelAnimationFrame(rafId);rafId=requestAnimationFrame(()=>centerActive(!0))}
function enable(){centerActive(!1);observer=new MutationObserver(()=>scheduleCenter());observer.observe(itemsWrap,{subtree:!0,attributes:!0,attributeFilter:["class"]});window.addEventListener("resize",onResize,{passive:!0});window.addEventListener("orientationchange",onResize,{passive:!0})}
function disable(){if(observer)observer.disconnect();observer=null;if(rafId)cancelAnimationFrame(rafId);rafId=null;window.removeEventListener("resize",onResize);window.removeEventListener("orientationchange",onResize);gsap.set(itemsWrap,{clearProps:"transform"})}
function onResize(){centerActive(!1)}
function handleMQ(e){if(e.matches)enable();else disable()}
handleMQ(mq);mq.addEventListener("change",handleMQ)}
function initAnchorFade(){const fadeEl=document.querySelector('.anchor-fade');if(!fadeEl)return;const terminalElements=fadeEl.querySelectorAll('[data-text-animation="terminal"][data-text-trigger="anchor"]');let fadeInTween=null;let fadeOutTween=null;let hideTimeout=null;let terminalTimelines=[];gsap.set(fadeEl,{opacity:0,pointerEvents:'none',visibility:'visible'});const terminalData=[];terminalElements.forEach((el)=>{gsap.set(el,{autoAlpha:1,visibility:'visible'});const split=new SplitText(el,{type:'words,chars',charsClass:'char',wordsClass:'word',autoSplit:!0});const chars=split.chars;if(!chars.length)return;const delay=parseFloat(el.getAttribute('data-text-delay'))||0;const charDuration=parseFloat(el.getAttribute('data-text-duration')||el.getAttribute('data-text-duration-seconds')||'1.8')||1.8;const charStagger=0.035;const cursorBlinkDuration=0.15;const cursorBlinkRepeats=4;const cursorFadeDuration=charDuration*0.7;const scrambleChars='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*-_+=;:<>?.';const lastIndex=chars.length-1;const textNodes=chars.map((char)=>{if(char.__terminalTextNode&&char.contains(char.__terminalTextNode)){return char.__terminalTextNode}
const textSpan=document.createElement('span');textSpan.className='terminal-char__text';textSpan.textContent=char.textContent||'';char.textContent='';char.appendChild(textSpan);char.__terminalTextNode=textSpan;return textSpan});terminalData.push({el,split,chars,textNodes,delay,charDuration,charStagger,cursorBlinkDuration,cursorBlinkRepeats,cursorFadeDuration,scrambleChars,lastIndex});gsap.set(textNodes,{autoAlpha:0});chars.forEach((char)=>{char.style.setProperty('--terminal-cursor-opacity','0')})});function animateTerminals(){terminalTimelines.forEach((tl)=>tl.kill());terminalTimelines=[];terminalData.forEach((data)=>{const{el,split,chars,textNodes,delay,charDuration,charStagger,cursorBlinkDuration,cursorBlinkRepeats,cursorFadeDuration,scrambleChars,lastIndex}=data;gsap.set(textNodes,{autoAlpha:0});chars.forEach((char)=>{char.style.setProperty('--terminal-cursor-opacity','0')});let currentCursorIndex=null;const setCursor=(targetIndex)=>{if(typeof currentCursorIndex==='number'&&chars[currentCursorIndex]){chars[currentCursorIndex].style.setProperty('--terminal-cursor-opacity','0');const previousTextNode=textNodes[currentCursorIndex];if(previousTextNode){gsap.to(previousTextNode,{autoAlpha:0.4,duration:0.2,ease:'power2.out',onComplete:()=>{gsap.to(previousTextNode,{autoAlpha:1,duration:0.2,ease:'power2.out'})}})}}
if(typeof targetIndex==='number'&&chars[targetIndex]){chars[targetIndex].style.setProperty('--terminal-cursor-opacity','1');currentCursorIndex=targetIndex}else{currentCursorIndex=null}};const tl=gsap.timeline({delay,defaults:{duration:charDuration,ease:'power2.out'}});textNodes.forEach((textNode,index)=>{tl.to(textNode,{scrambleText:{text:'{original}',chars:scrambleChars,speed:0.55},onStart:()=>{setCursor(index);gsap.set(textNode,{autoAlpha:1})}},index*charStagger)});const lastCharStart=lastIndex*charStagger;const cursorBlinkTl=gsap.timeline();cursorBlinkTl.to(chars[lastIndex],{duration:cursorBlinkDuration,'--terminal-cursor-opacity':0,repeat:cursorBlinkRepeats,yoyo:!0,ease:'none'}).to(chars[lastIndex],{duration:cursorFadeDuration,'--terminal-cursor-opacity':0,ease:'power1.inOut',onComplete:()=>setCursor(null)});tl.add(()=>setCursor(lastIndex),lastCharStart);tl.add(cursorBlinkTl,lastCharStart);terminalTimelines.push(tl)})}
function showAnchorFade(){if(fadeInTween)fadeInTween.kill();if(fadeOutTween)fadeOutTween.kill();if(hideTimeout)clearTimeout(hideTimeout);gsap.set(fadeEl,{pointerEvents:'auto'});fadeInTween=gsap.to(fadeEl,{opacity:1,duration:0.5,ease:'power2.out',onStart:()=>{animateTerminals()},onComplete:()=>{hideTimeout=setTimeout(()=>{hideAnchorFade()},2000)}})}
function hideAnchorFade(){if(fadeOutTween)fadeOutTween.kill();fadeOutTween=gsap.to(fadeEl,{opacity:0,duration:0.5,ease:'power2.out',onComplete:()=>{gsap.set(fadeEl,{pointerEvents:'none'})}})}
document.addEventListener('click',(e)=>{const link=e.target.closest('.fixed-anchor');if(!link)return;showAnchorFade()})}
function initPortfolioProximaTextToggle(){if(document.documentElement.dataset.proximaTextObserverInit==="true")return;document.documentElement.dataset.proximaTextObserverInit="true";const proximaTexts=Array.from(document.querySelectorAll(".proxima-text"));if(!proximaTexts.length)return;const missionSection=document.getElementById("section-mission");const proximaCompany7=document.querySelector('.scroll-section[data-era="proxima"][data-company="7"]');if(!missionSection&&!proximaCompany7)return;if(!("IntersectionObserver" in window))return;const setActive=(isActive)=>{proximaTexts.forEach((el)=>el.classList.toggle("is-active",!!isActive))};let lastState=null;const applyState=(nextState)=>{if(nextState===lastState)return;lastState=nextState;setActive(nextState)};if(missionSection){const missionObserver=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(!entry.isIntersecting)return;applyState(!1)})},{threshold:0,rootMargin:"0px 0px 0px 0px"});missionObserver.observe(missionSection)}
if(proximaCompany7){const proximaObserver=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(!entry.isIntersecting)return;applyState(!0)})},{threshold:0.35,rootMargin:"0px 0px 0px 0px"});proximaObserver.observe(proximaCompany7)}}
function initModalEscClose(){document.addEventListener("keydown",(e)=>{if(e.key!=="Escape")return;const modals=document.querySelectorAll('[data-company-modal].is-visible.is-open');if(!modals.length)return;modals.forEach((modal)=>{modal.classList.remove("is-visible","is-open");modal.querySelectorAll(".is-open").forEach((el)=>el.classList.remove("is-open"))})})}
function initModalCardExpandImage(){const DESKTOP_QUERY="(hover: hover) and (pointer: fine) and (min-width: 992px)";if(!window.matchMedia(DESKTOP_QUERY).matches)return;const MODAL_SELECTOR="[data-company-modal], [data-join-modal]";const CARD_SELECTOR=".modal__card";const EXPAND_TRIGGER_SELECTOR=".expand-image";const GLITCH_LINE_SELECTOR=".fixed-anchor__text.glitch-line";const GLITCH_LEFT_SELECTOR=".fixed-anchor-glitch.is-left";const GLITCH_RIGHT_SELECTOR=".fixed-anchor-glitch.is-right";const CARD_EXPANDED_CLASS="is-image-expanded";const originalsByModal=new WeakMap();const getModalFrom=(el)=>el?.closest?.(MODAL_SELECTOR)||null;const getCard=(modal)=>modal?.querySelector?.(CARD_SELECTOR)||null;const isModalOpen=(modal)=>modal.classList.contains("is-visible")&&modal.classList.contains("is-open");const cacheOriginals=(modal)=>{if(originalsByModal.has(modal))return;const map=new Map();modal.querySelectorAll(GLITCH_LINE_SELECTOR).forEach((line)=>{map.set(line,line.textContent)});originalsByModal.set(modal,map)};const setGlitchText=(modal,text)=>{modal.querySelectorAll(GLITCH_LINE_SELECTOR).forEach((line)=>{line.textContent=text})};const restoreGlitchText=(modal)=>{const map=originalsByModal.get(modal);if(!map)return;map.forEach((originalText,lineEl)=>{if(lineEl&&lineEl.isConnected)lineEl.textContent=originalText})};const setExpandButtonSide=(modal,expanded)=>{const left=modal.querySelector(GLITCH_LEFT_SELECTOR);const right=modal.querySelector(GLITCH_RIGHT_SELECTOR);if(left)left.style.opacity=expanded?"1":"0";if(right)right.style.opacity=expanded?"0":"1"};const setExpanded=(modal,expand)=>{const card=getCard(modal);if(!modal||!card)return;cacheOriginals(modal);if(expand){card.classList.add(CARD_EXPANDED_CLASS);setGlitchText(modal,"MINIMISE IMAGE");setExpandButtonSide(modal,!0)}else{card.classList.remove(CARD_EXPANDED_CLASS);restoreGlitchText(modal);setExpandButtonSide(modal,!1)}};const isExpanded=(modal)=>getCard(modal)?.classList.contains(CARD_EXPANDED_CLASS);document.querySelectorAll(MODAL_SELECTOR).forEach((modal)=>{setExpandButtonSide(modal,!1)});document.addEventListener("click",(e)=>{const modal=getModalFrom(e.target);if(!modal)return;if(!isModalOpen(modal))return;if(e.target.closest(EXPAND_TRIGGER_SELECTOR)){e.preventDefault();setExpanded(modal,!isExpanded(modal));return}
if(e.target.closest(GLITCH_LINE_SELECTOR)&&isExpanded(modal)){e.preventDefault();setExpanded(modal,!1)}},!0);document.querySelectorAll(MODAL_SELECTOR).forEach((modal)=>{const obs=new MutationObserver(()=>{if(!isModalOpen(modal)&&isExpanded(modal)){setExpanded(modal,!1)}else if(isModalOpen(modal)){setExpandButtonSide(modal,isExpanded(modal))}});obs.observe(modal,{attributes:!0,attributeFilter:["class"]})})}
document.addEventListener("DOMContentLoaded",()=>{initPageTransition();initEyebrowAnimation();initMenuAnimation();initNavAnimation();initBackgroundFadeAnimation();initIdleEasterEgg();initFooterTextAnimation();initMetricScrubber();initAnchorFade();initHeadingScrollAnimation();initTerminalScrollAnimation();initHighlightText();initRandomScrollAnimation();initPreloaderAnimation();initHomeDefineAnimation();initModalAnimation();initHeroAnimation();initFounderAsciiReveal();initCompanyNavMobileCentering();initPortfolioProximaTextToggle()
initModalEscClose();initModalCardExpandImage()})